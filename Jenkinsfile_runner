pipeline {
    agent {label 'docker-slave-cloud'}
    stages {
        stage ("Setup environment") {
            steps {
                // sh "apk update && apk add py-pip python3-dev libffi-dev openssl-dev gcc libc-dev make"
                // sh "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y" // install rust
                // sh "source $HOME/.cargo/env" // configure rust environment path
                // sh "pip install docker-compose"
                sh "docker-compose down"
            }
        }
        stage ("Execute Test") {
            steps {
                sh "docker-compose up --no-color --scale chrome=2 --scale firefox=2 -d selenium-hub chrome firefox"
                sh "docker-compose up search-module"
            }
        }
        stage ("Teardown environment") {
            steps {
                sh "docker-compose down"
            }
        }
    }
}